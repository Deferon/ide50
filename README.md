## CS50 Appliance 2014
It is assumed that the repo is cloned into ~/appliance50, though it may be placed anywhere.

### Setting up your development VM (do once)
1. This assumes you're using the CS50 Appliance 2014. If you want to rebuild the appliance iso, you can optionally allocate multiple processors to speed up the squashfs process.
2. `cd ~/ && git clone -b rob git@github.com:cs50/appliance50.git`
3. `cd ~/appliance50 && make host`

### Rolling a new version of appliance50 deb
1. `cd ~/appliance50/appliance50-2014/files`
2. Make desired changes. Be sure to ovewrite `/etc/appliance50` with the new version
3. Use your favorite text editor to add a new changelog entry to
4. `~/appliance50/appliance50-2014/debian/changelog`
5. If you'd like to chmod stuff, do so in `~/appliance50/appliance50-2014/debian/postinst` after jharvard user is created
6. Now make the local deb with
7. `cd ~/appliance50/ && make deb`
8. New deb can be found at `~/appliance50/build/deb/` At this point if you'd like to test the deb in your machine before pushing to mirror you can do `sudo dpkg -i appliance50_2014-*.deb`

### Pushing deb to mirror
1. Assuming deb was already built via the steps above do
2. `cd ~/appliance50/build/deb`
3. `scp appliance50_2014-*.deb user@local.cdn.cs50.net:~ # copy the deb to mirror`
4. `ssh user@local.cdn.cs50.net`
5. `sudo su rbowden # rbowden has the script to update the deb in mirror`
6. `cp appliance50_2014-*.deb /home/rbowden # copy the deb to rbowden's home folder`
7. Finally execute the script that effectively uploads all debs in rbowden's home folder to production
8. `sudo /home/rbowden/deb/deb.sh`
9. At this point it's a good idea to test `sudo apt-get update` in the appliance to make sure everything works. Also, logs and errors generated by update50 can be found at `/var/log/appliance50.log`

### Setting up an iso build directory (only need to repeat if prep-work or install-script change)
1. `cd ~/appliance50 && make prep`

### Modifying boot image (optional)
1. `cd ~/appliance50/image`
2. Make desired changes.

### Finalizing installer ISO
1. `cd ~/appliance50 && make post`
2. ISO may be found at `~/appliance50/build/appliance50.iso`

## Solutions to Various Tasks

#### Appliance fails to suspend, giving error "The request to Suspend this virtual machine failed because the VMware tools script did not run successfully"
https://github.com/cs50/appliance50/commit/1fdcbb378045df5111ba5788f51116f4a9babc82

#### Changing terminal background and foreground colors
1. `sudo apt-get install dconf-editor`
2. `dconf-editor`
3. Navigate to `org > gnome > gedit > plugins > terminal`
4. Uncheck `use-theme-colors`
5. Set background-color (black: #000000) and foreground-color (white: #FFFFFF)
6. Close `dconf-editor`
7. New settings are saved inside the binary `~jharvard/.config/dconf/user`. Note that this file contains various other
preferences, so any changes should probably be made to a fresh appliance install and immediately copied from this file
before other unwanted changes make their way into the file.

#### Editing gedit preferences
1. Open `gedit`
2. `Edit > Preferences`
3. Set desired plugins, themes, etc.
4. Close `gedit`
5. New settings are saved inside the binary `~jharvard/.config/dconf/user`. Note that this file contains various other
preferences, so any changes should probably be made to a fresh appliance install and immediately copied from this file
before other unwanted changes make their way into the file.

#### Error on Ubuntu splash screen during install: piix4\_smbus ... Host SMBuscontroller not enabled!
https://github.com/cs50/appliance50/blob/e1537ca1045eeb50aa281251086f676a62a343fe/appliance50-2014/files/etc/modprobe.d/blacklist.conf.appliance50#L57-L59

#### Updating terminal settings
Edit the file `~jharvard/.config/xfce4/terminal/terminalrc`.

#### Updating bottom toolbar appearance
Edit the file
`~jharvard/.config/xfce4/xfconf/xfce-perchannel-xml/xfce4-panel.xml`. The
ordering of items is determined by the `plugin-ids` array. The appearance of a
separator is determined by the `style` property associated with the appropriate
`plugin` property in the `plugins` array.

#### Adding, e.g., version number or a launcher to bottom toolbar
1. Look at the file
`~jharvard/.config/xfce4/xfconf/xfce-perchannel-xml/xfce4-panel.xml`. Choose a
plugin id that isn't already taken in the `plugin-ids` array. The plugin id must
be numeric. Here, let's choose the id `50`.

2. Add the appropriate file to `~jharvard/.config/xfce4/panel`. If adding a
monitor, create a `genmon-50.rc` file, which looks something like
https://github.com/cs50/appliance50/blob/391c47bf9ca3ee644168f0c0a446d2f26c02f195/appliance50-2014/files/home/jharvard/.config/xfce4/panel/genmon-16.rc.
If adding a launcher, create a directory called `launcher-50`, inside of which
goes a file called, e.g., `14055534482.desktop`. The standard name is the Unix
timestamp of when the file was created, though it doesn't actually matter. This
file looks something like
https://github.com/cs50/appliance50/blob/391c47bf9ca3ee644168f0c0a446d2f26c02f195/appliance50-2014/files/home/jharvard/.config/xfce4/panel/launcher-3/14055533311.desktop

3. Open the file `~jharvard/.config/xfce4/xfconf/xfce-perchannel-xml/xfce4-panel.xml`.
4. Add `<value type="int" value="50"/>` to the `plugin-ids` array at the desired location. The placement in this array determines the physical placement in the toolbar.
5. Anywhere within the `plugins` property, add your new property (ideally, place
it in the same position it appears in the `plugin-ids` array). If you added a
launcher, then the new property should look something like
https://github.com/cs50/appliance50/blob/391c47bf9ca3ee644168f0c0a446d2f26c02f195/appliance50-2014/files/home/jharvard/.config/xfce4/xfconf/xfce-perchannel-xml/xfce4-panel.xml#L61-L65.
If you are adding a new monitor (like version number), the property should look something like `<property name="plugin-50" type="string" value="genmon"/>`

#### Add, e.g., TeamViewer to menu
https://github.com/cs50/appliance50/commit/29e909633b0641708abeae5fd069a42f63cb99d1
