#!/bin/bash

# find ide version
source /etc/version50 2>/dev/null
if [ "$version" == "" ]; then
    declare version="n/a"
fi

# if we received a domain from the stats plugin, save it
if [ $# -eq 1 ]; then
    echo "domain=\"$1\"" >/home/ubuntu/.domain50
fi

# ask lsof if port 8080 is open, will return 0 if so, 1 otherwise
set -o pipefail
server=$(lsof -n -i :8080 | awk 'NR==2 {print $1}')
if [ $? == 0 ]; then
    listening="true"
else
    listening="false"
    server="NONE"
fi

printf '{"version":"%s","host":"%s","listening":%s,"server":"%s","user":"%s","passwd":"%s"}' \
    "$version" "$(hostname50)" "$listening" "$server" "$(username50)" "$(password50)"
