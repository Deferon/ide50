#!/bin/bash
#
# This is CS50 update!
#
# To run, execute "update50" at the command line.

echo 'Updating appliance. Please do not turn off your computer or put it to sleep!'

sudo echo -e "\n\n\nUpdate50 - $(date -R)" | sudo tee -a /var/log/ide50.log > /dev/null
echo 'Updating sources...'
sudo apt-get update 2>&1 | sudo tee -a /var/log/ide50.log > /dev/null
if [ $? -ne 0 ]
then
    echo 'Something went wrong. More information can be found in /var/log/ide50'
    exit 1
fi

echo 'Reinstalling appliance package...'
sudo apt-get -o Dpkg::Options::="--force-confnew" -o Dpkg::Options::="--force-overwrite" install --reinstall --yes --force-yes --assume-yes ide50 2>&1 | sudo tee -a /var/log/ide50.log > /dev/$
if [ $? -ne 0 ]
then
    echo 'Something went wrong. More information can be found in /var/log/ide50'
    exit 1
fi

echo 'Upgrading packages...'
sudo apt-get -o Dpkg::Options::="--force-confnew" -o Dpkg::Options::="--force-overwrite"  --yes --force-yes --assume-yes dist-upgrade 2>&1 | sudo tee -a /var/log/ide50.log > /dev/null
if [ $? -ne 0 ]
then
    echo 'Something went wrong. More information can be found in /var/log/ide50'
    exit 1
fi

echo 'Reinstalling appliance package again...'
sudo apt-get -o Dpkg::Options::="--force-confnew" -o Dpkg::Options::="--force-overwrite" install --reinstall --yes --force-yes --assume-yes ide50 2>&1 | sudo tee -a /var/log/ide50.log > /dev/$
if [ $? -ne 0 ]
then
    echo 'Something went wrong. More information can be found in /var/log/ide50'
    exit 1
fi

echo 'Update complete!'